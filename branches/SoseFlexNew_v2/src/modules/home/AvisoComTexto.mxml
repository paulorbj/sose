<?xml version="1.0" encoding="utf-8"?>
<home:AvisoContainer 
	xmlns:fx="http://ns.adobe.com/mxml/2009" 
	width="100%" 
	height="100%" 
	
	xmlns:components="components.*"			   
	xmlns:s="library://ns.adobe.com/flex/spark" 
	tituloDoAviso="{aviso.titulo}" 
	creationPolicy="all" 
	horizontalScrollPolicy="off" 
	verticalScrollPolicy="off"
	xmlns:mx="library://ns.adobe.com/flex/mx" 
	xmlns:home="modules.home.*" 
	xmlns:combos="components.combos.*" 
	xmlns:textInput="components.textInput.*" >
	
	<fx:Declarations>
		<mx:RemoteObject id="avisoService" destination="avisoService" endpoint="{resourceManager.getString('ConfigurationResource','amf')}">			
			<mx:method name="salvarAviso"      
					   fault="onSalvarAvisoFault(event)" 
					   result="onSalvarAvisoResult(event)"
					   />
		</mx:RemoteObject>
	</fx:Declarations>
	
	
	<fx:Script>
		<![CDATA[
			import entities.administrativo.parceiros.Pessoa;
			import entities.componentes.Aviso;
			
			import flashx.textLayout.conversion.ConversionType;
			import flashx.textLayout.conversion.TextConverter;
			import flashx.textLayout.elements.TextFlow;
			
			import mx.collections.ArrayCollection;
			import mx.managers.CursorManager;
			import mx.rpc.events.FaultEvent;
			import mx.rpc.events.ResultEvent;
			
			import spark.utils.TextFlowUtil;
			
			/* [Bindable]
			public var dadosGrafico:ArrayCollection;
			 */
			
			[bindable]
			private var mwidth:Number;
			
			[bindable]
			private var mheight:Number;
			
			[bindable]
			public var aviso:Aviso;
			
			[bindable]
			private var mensagemRT:TextFlow;
			
			[bindable]
			private var mensagemString:String;
			
			private function CapabilitiesMax():void
			{
				//mwidth = 0.3*Capabilities.screenResolutionX;
				//mheight = 0.3*Capabilities.screenResolutionY;
			}
			
			private function init():void
			{
				//graficoService.buscarInfoGraficoReparoFinalizadoPorCondicao(null,null,null,null,null,null);
				//textoTitulo.inputText = tituloDoAviso;
				//super.cancelar = cancelar;
				//textoTitulo.inputText = aviso.titulo;
				if (aviso){
					mensagemString = aviso.mensagem;
					mensagemRT = converteHTMLparaRTF(aviso.mensagem);
				}
				else{
					aviso = new Aviso();
					aviso.mensagem = "Aviso estava como null";
					aviso.titulo = "Titulo do aviso null";
					aviso.id = 999;
					
				}
				
				//myRTE.htmlText = aviso.mensagem;
				//textoRich.textFlow = mensagemRT;
				
			}
			
			private function converteRTFparaHTML(myRTE:TextFlow):String{
							
				return TextConverter.export(myRTE, TextConverter.TEXT_FIELD_HTML_FORMAT, ConversionType.STRING_TYPE) as String;
			}
			
			private function converteHTMLparaRTF(stringHTML:String ):TextFlow{
				return TextConverter.importToFlow(stringHTML, TextConverter.TEXT_FIELD_HTML_FORMAT) as TextFlow;
			
			}
			
			protected function aplicar(event:MouseEvent):void
			{
				//graficoService.buscarInfoGraficoReparoFinalizadoPorCondicao(dataDe.inputDate,dataAte.inputDate,cliente.clienteSelecionado,laboratorio.laboratorioSelecionado,tecnico.usuarioSelecionado, unidade.unidadeSelecionado);
			}
			
			override public function fechar():void
			{
				
				super.mudarParaVisualizacao();
				mensagemString = aviso.mensagem;
				aviso.mensagem = myRTE.htmlText;
				aviso.titulo = textoTitulo.inputText;
				mensagemRT = converteHTMLparaRTF(aviso.mensagem);
				//tituloDoAviso = aviso.titulo;
				//textoRich.textFlow = TextConverter.importToFlow(myRTE.htmlText, TextConverter.TEXT_FIELD_HTML_FORMAT);
				textoTitulo.inputText = aviso.titulo;
				//mensagemString = aviso.mensagem;
				avisoService.salvarAviso(aviso);
			}
			
			override public function abrirConfig():void
			{
				
				super.mudarParaConfiguracao();
				mensagemString = aviso.mensagem;
				//myRTE.htmlText = TextConverter.export(textoRich.textFlow, TextConverter.TEXT_FIELD_HTML_FORMAT, ConversionType.STRING_TYPE) as String;
				//myRTE.htmlText = aviso.mensagem;
				
			}
			
			
			protected function limpar(event:MouseEvent=null):void
			{

			}

			
			private function onSalvarAvisoResult(event:ResultEvent = null):void
			{
				CursorManager.removeAllCursors(); 
				aviso = event.result as Aviso;
			}
			
			private function onSalvarAvisoFault(event:FaultEvent = null):void
			{
				CursorManager.removeAllCursors();
				trace("[onSalvarAvisoFault] [" +	event.fault.faultCode + "] " + event.fault.faultString + " (" +	event.fault.faultDetail + ")");		
			}
			
		]]>
	</fx:Script>

		
	<home:visualizacao>
		 
<!--		<mx:VBox width="100%" height="100%" >-->
			<s:Scroller width="100%"  height="100%" focusEnabled="false">
				<s:Group clipAndEnableScrolling="true"  >
					<s:RichText textFlow="{converteHTMLparaRTF(aviso.mensagem)}" id="textoRich" width="100%" height="100%" creationComplete="init()" />
						
					
				</s:Group>
			</s:Scroller>
			
			
			
			
			
			
<!--		</mx:VBox>-->
	</home:visualizacao>
	
	<home:configuracao>
		<mx:VBox width="100%" height="100%" paddingTop="5" paddingRight="5" paddingLeft="5" horizontalScrollPolicy="off" verticalScrollPolicy="off">
			<mx:HBox width="100%" verticalAlign="middle">
				<s:Label text="Titulo do aviso:" />
				<textInput:TextInput id="textoTitulo" width="100%" />
			</mx:HBox>
			
			<mx:HBox bottom="5" width="100%" height="100%">
				<mx:RichTextEditor id="myRTE" htmlText="{aviso.mensagem}"  height="100%" width="100%" />
			</mx:HBox>
		</mx:VBox>

	</home:configuracao>
	
</home:AvisoContainer>
